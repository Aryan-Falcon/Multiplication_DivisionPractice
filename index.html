<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multiplication RPG — Arcane Tower</title>

<style>
body {
    margin: 0;
    font-family: 'Georgia', serif;
    background: radial-gradient(circle at center, #3a0057, #120018);
    color: #f8e7ff;
    overflow-x: hidden;
}

h1 {
    text-align: center;
    font-size: 42px;
    margin-top: 20px;
    text-shadow: 0 0 15px #ff6cff;
}

/* ===== RANK BAR ===== */
#rank-panel {
    position: fixed;
    top: 100px;
    left: 20px;
    display: flex;
    gap: 10px;
    gap: 14px;
}

#rank-bar {
@@ -47,6 +47,13 @@
    transition: height 0.4s ease;
}

#rank-labels {
    height: 300px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.rank {
    opacity: 0.25;
    transition: opacity 0.3s, text-shadow 0.3s;
@@ -107,22 +114,15 @@
    border: none;
}

#feedback {
    font-size: 32px;
    text-align: center;
    display: none;
}

/* ===== SPELLS ===== */
.spell {
    position: absolute;
    width: 65px;
    height: 65px;
    border-radius: 50%;
    pointer-events: none;
    filter: blur(0.3px);
    box-shadow: 0 0 25px currentColor;
    animation: fly 0.75s cubic-bezier(.4,0,.6,1) forwards;
    animation: fly 0.8s ease-out forwards;
    z-index: 999;
}

@@ -132,12 +132,10 @@
.dark   { background: radial-gradient(circle, #fff, #660000); color:#aa0000; }

@keyframes fly {
    from { transform: translate(0,0) scale(1); opacity: 1; }
    to   { transform: translate(420px,-60px) scale(0.6); opacity: 0; }
}
@keyframes flyBack {
    from { transform: translate(0,0) scale(1); opacity: 1; }
    to   { transform: translate(-420px,-60px) scale(0.6); opacity: 0; }
    to {
        transform: translate(var(--dx), var(--dy)) scale(0.6);
        opacity: 0;
    }
}

.hit { animation: flash 0.3s; }
@@ -161,7 +159,7 @@

<div id="rank-panel">
    <div id="rank-bar"><div id="rank-fill"></div></div>
    <div>
    <div id="rank-labels">
        <div class="rank" id="r6">Grandmaster</div>
        <div class="rank" id="r5">Archmage</div>
        <div class="rank" id="r4">Mage</div>
@@ -184,12 +182,11 @@
<div id="timer">⏳ Time: 20</div>
<div id="question-box"></div>
<input id="answer" type="number" placeholder="ENTER">
<div id="feedback"></div>

<script>
let questions=[], current=0, score=0, streak=0, monstersDefeated=0;
let heroHP=100, monsterHP=60, timer, timeLeft;
const FIXED_TIME = 20; // ⏳ UPDATED TIMER
const FIXED_TIME = 20;

const monsterImages = {
1:"https://p1.hiclipart.com/preview/549/267/644/monster-rpg-maker-mv-rpg-maker-vx-game-roleplaying-game-slime-slime-morimori-dragon-quest-video-game-development-png-clipart.jpg",
@@ -215,98 +212,108 @@
    let s=document.createElement("div");
    s.className=`spell ${type}`;
    document.body.appendChild(s);

    let from=document.getElementById(heroCast?"hero":"monster").getBoundingClientRect();
    s.style.left=from.left+120+"px";
    s.style.top=from.top+80+"px";
    s.style.animationName=heroCast?"fly":"flyBack";
    setTimeout(()=>s.remove(),750);
    let to=document.getElementById(heroCast?"monster":"hero").getBoundingClientRect();

    let startX = from.left + from.width/2;
    let startY = from.top + from.height/2;
    let endX = to.left + to.width/2;
    let endY = to.top + to.height/2;

    s.style.left = startX+"px";
    s.style.top  = startY+"px";
    s.style.setProperty("--dx", (endX-startX)+"px");
    s.style.setProperty("--dy", (endY-startY)+"px");

    setTimeout(()=>s.remove(),800);
}

function updateRank(){
    let acc=current?score/current:0;
    document.getElementById("rank-fill").style.height=Math.min(acc*100,100)+"%";
    let lvl=acc===1?6:acc>=.85?5:acc>=.7?4:acc>=.55?3:acc>=.35?2:1;
    for(let i=1;i<=6;i++)
        document.getElementById("r"+i).classList.toggle("active",i<=lvl);
}

function startTimer(){
    clearInterval(timer);
    timeLeft=FIXED_TIME;
    document.getElementById("timer").innerText=`⏳ Time: ${timeLeft}`;
    timer=setInterval(()=>{
        document.getElementById("timer").innerText=`⏳ Time: ${--timeLeft}`;
        if(timeLeft<=0){ clearInterval(timer); monsterAttack(true); }
    },1000);
}

function showQuestion(){
    let q=questions[current];
    document.getElementById("question-box").innerText=`${q.a} × ${q.b} = ?`;
}

function spawnMonster(){
    monsterHP=60;
    monster.style.backgroundImage=`url('${monsterImages[monstersDefeated+1]}')`;
    document.getElementById("monster-hp").style.width="100%";
}

function monsterAttack(timeout){
    castSpell("dark",false);
    heroHP-=timeout?20:10;
    hero.classList.add("shake");
    setTimeout(()=>hero.classList.remove("shake"),400);
    document.getElementById("hero-hp").style.width=heroHP+"%";
    next();
}

function submitAnswer(){
    clearInterval(timer);
    let q=questions[current];
    let val=Number(answer.value);
    answer.value="";

    if(val===q.a*q.b){
        streak++; score++;
        castSpell(streak>=6?"grand":streak>=3?"fire":"arcane",true);
        monster.classList.add("hit");
        setTimeout(()=>monster.classList.remove("hit"),300);
        monsterHP-=20;
        document.getElementById("monster-hp").style.width=monsterHP+"%";
        if(monsterHP<=0){
            monstersDefeated++;
            if(monstersDefeated>=14) return endGame();
            spawnMonster();
        }
    } else {
        streak=0;
        monsterAttack(false);
        return;
    }
    next();
}

function next(){
    current++; updateRank();
    if(heroHP<=0) return endGame();
    showQuestion(); startTimer();
}

function endGame(){
    document.body.innerHTML=`<h1>Game Over</h1>
    <p style="text-align:center">Correct: ${score}/${current}</p>
    <p style="text-align:center">Monsters Defeated: ${monstersDefeated}</p>
    <p style="text-align:center">Rank: ${document.querySelector(".rank.active")?.innerText}</p>
    <button onclick="location.reload()">Play Again</button>`;
}

answer.addEventListener("keydown",e=>e.key==="Enter"&&submitAnswer());

document.getElementById("hero-hp").style.width="100%";
spawnMonster();
showQuestion();
startTimer();
</script>

</body>
</html>
